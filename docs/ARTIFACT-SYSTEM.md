# Artifact System

This document details the artifact system in the AI Chatbot, which allows the AI to generate and share specialized content such as documents, images, and data tables.

## Overview

Artifacts are special types of content that can be generated by the AI and displayed in a dedicated panel in the UI. They provide a richer experience beyond simple text messages, allowing for interactive documents, images, and structured data.

## Artifact Types

The system currently supports three types of artifacts:

1. **Text Artifacts**: Formatted text documents with Markdown support
   - File extension: `.md`
   - Used for: Essays, documentation, code snippets

2. **Image Artifacts**: Visual content generated by the AI
   - File formats: PNG, JPG
   - Used for: Diagrams, charts, illustrations

3. **Sheet Artifacts**: Tabular data in spreadsheet format
   - File format: CSV
   - Used for: Data tables, structured information

## Architecture

### Core Components

1. **Artifact Component** (`components/artifact.tsx`): 
   - Main container for the artifact panel
   - Controls visibility and state
   - Integrates different artifact viewers
   - Manages version history and document storage

2. **DataStreamHandler** (`components/data-stream-handler.tsx`):
   - Manages streaming data for artifacts
   - Processes artifact deltas as they arrive
   - Updates the artifact state in real-time

3. **ArtifactMessages** (`components/artifact-messages.tsx`):
   - Specialized message display for artifacts
   - Shows interactions related to the current artifact
   - Provides context for artifact creation and modifications

4. **VersionFooter** (`components/version-footer.tsx`):
   - Manages version history interface
   - Allows navigation between document versions
   - Provides version restoration functionality

### Attachment Structure

Artifacts are transmitted as attachments to messages with the following structure:

```typescript
interface Attachment {
  type: string;       // 'image', 'text', 'sheet', or with '-delta' suffix
  name?: string;      // Optional name for the attachment
  content?: string;   // The actual content (base64 for images, text for others)
  url: string;        // URL reference, often with 'artifact:' scheme
}
```

## Data Flow

### Artifact Creation

1. User sends a message that triggers artifact generation
2. AI responds with an initial message
3. AI streams artifact data as attachments with '-delta' type suffix
4. DataStreamHandler processes these deltas and updates the UI
5. Artifact panel becomes visible showing the generated content

### Artifact Interaction

1. User interacts with the artifact (edits text, views image, etc.)
2. Interactions are processed by the specific artifact viewer
3. Changes can be sent back to the AI as messages
4. AI can respond to changes or provide further content

## Document Storage Systems

The artifact system supports two storage strategies:

### 1. API-Based Document Storage

For production environments, documents are stored via API:
- Documents are fetched from `/api/document?id=${documentId}`
- Updates are posted to the same endpoint
- Versions are managed on the server side
- Authentication and access control handled by the API

### 2. Local Document Storage

For development or special document types:
- Documents with `local:` prefix or special URIs (http://, text:, sheet:) use local storage
- Document history is stored in browser localStorage
- Each edit creates a new version with timestamp
- Versions can be navigated, compared, and restored
- Key format: `local-document-${documentId}`

## Version Control System

The artifact system now includes a robust version control system:

1. **Version Creation**:
   - Each edit automatically creates a new version
   - Versions include timestamps and content changes
   - Debounced saving prevents excessive version creation

2. **Version Navigation**:
   - Users can move between versions using toolbar controls
   - Navigation includes previous, next, and latest version options
   - Current version status is clearly indicated

3. **Version Comparison**:
   - 'diff' mode allows comparing changes between versions
   - The current implementation focuses on showing different versions
   - Future updates will include detailed difference highlighting

4. **Version Restoration**:
   - Users can restore previous versions
   - Restoration works for both API and local storage documents
   - After restoration, the system returns to edit mode with the restored content

## User Interface Components

### Split Panel Layout

On desktop devices, the artifact view uses a split panel layout:
- Left panel (400px): Shows messages related to the artifact
- Right panel (remaining width): Displays the artifact content
- Both panels scroll independently

On mobile devices, the interface adapts to show only the artifact content for better usability.

### Animation and Transitions

The artifact interface includes smooth animations for:
- Opening and closing the artifact panel
- Transitioning between versions
- Showing/hiding the version footer
- Indicating saving status

### Responsive Design

The UI adjusts based on device size:
- Desktop: Split panel with messages and content
- Mobile: Full-screen artifact view with optimized controls
- Adaptive sizing based on window dimensions

## Testing Artifacts

Special commands trigger artifact generation in the mock implementation:

- `test image artifact`: Generates a sample image
- `test text artifact`: Creates a text document
- `test sheet artifact`: Produces a spreadsheet

## Integration with Real Backend

When implementing with a real backend:

1. Replace sample content generation with actual AI-generated content
2. Implement proper artifact storage (S3, database, etc.)
3. Leverage the existing version control system
4. Implement authentication for artifact access
5. Add collaboration features for shared artifacts

## Recent Improvements

The artifact system has been recently enhanced with:

1. **Unified Storage Handling**: Consistent approach for both API and local storage
2. **Improved Version History**: Better UI for navigating versions
3. **Performance Optimizations**: Debounced content saving and memoized components
4. **Visual Feedback**: Clear indicators for saving status and version information
5. **Mobile Responsiveness**: Optimized experience across device sizes

## Future Enhancements

Planned features for the artifact system:

1. **Collaborative Editing**: Allow multiple users to work on artifacts simultaneously
2. **Enhanced Diff Visualization**: Better visualization of changes between versions
3. **Advanced Export Options**: Additional export formats for artifacts
4. **Integration with External Tools**: Connect to third-party services
5. **Offline Support**: Improved capabilities when working without network connection 