# Artifact System

This document details the artifact system in the AI Chatbot, which allows the AI to generate and share specialized content such as documents, images, and data tables.

## Overview

Artifacts are special types of content that can be generated by the AI and displayed in a dedicated panel in the UI. They provide a richer experience beyond simple text messages, allowing for interactive documents, images, and structured data.

## Artifact Types

The system currently supports three types of artifacts:

1. **Text Artifacts**: Formatted text documents with Markdown support
   - File extension: `.md`
   - Used for: Essays, documentation, code snippets

2. **Image Artifacts**: Visual content generated by the AI
   - File formats: PNG, JPG
   - Used for: Diagrams, charts, illustrations

3. **Sheet Artifacts**: Tabular data in spreadsheet format
   - File format: CSV
   - Used for: Data tables, structured information

## Architecture

### Core Components

1. **Artifact Component** (`components/artifact.tsx`): 
   - Main container for the artifact panel
   - Controls visibility and state
   - Integrates different artifact viewers

2. **DataStreamHandler** (`components/data-stream-handler.tsx`):
   - Manages streaming data for artifacts
   - Processes artifact deltas as they arrive
   - Updates the artifact state in real-time

3. **ArtifactMessages** (`components/artifact-messages.tsx`):
   - Specialized message display for artifacts
   - Shows interactions related to the current artifact

4. **PreviewAttachment** (`components/preview-attachment.tsx`):
   - Renders attachment previews within messages
   - Supports different attachment types

### Attachment Structure

Artifacts are transmitted as attachments to messages with the following structure:

```typescript
interface Attachment {
  type: string;       // 'image', 'text', 'sheet', or with '-delta' suffix
  name?: string;      // Optional name for the attachment
  content?: string;   // The actual content (base64 for images, text for others)
  url: string;        // URL reference, often with 'artifact:' scheme
}
```

## Data Flow

### Artifact Creation

1. User sends a message that triggers artifact generation
2. AI responds with an initial message
3. AI streams artifact data as attachments with '-delta' type suffix
4. DataStreamHandler processes these deltas and updates the UI
5. Artifact panel becomes visible showing the generated content

### Artifact Interaction

1. User interacts with the artifact (edits text, views image, etc.)
2. Interactions are processed by the specific artifact viewer
3. Changes can be sent back to the AI as messages
4. AI can respond to changes or provide further content

## Mock Implementation

The current implementation uses `mockApiService.ts` to simulate artifact generation:

```typescript
// Example from mock-api-service.ts
if (isTestImageRequest) {
  onChunk({
    id: generateUUID(),
    role: 'assistant',
    content: '',
    createdAt: new Date(),
    reasoning: 'Generating image artifact',
    attachments: [
      {
        type: 'image-delta',
        url: `artifact:${artifactId}`,
        content: SAMPLE_IMAGE_BASE64,
      },
    ],
  });
}
```

## Testing Artifacts

Special commands trigger artifact generation in the mock implementation:

- `test image artifact`: Generates a sample image
- `test text artifact`: Creates a text document
- `test sheet artifact`: Produces a spreadsheet

## Artifact Viewers

Each artifact type has a specialized viewer component:

### Text Artifact Viewer

- Provides a Markdown editor for text content
- Supports formatting and structure
- Allows real-time editing

### Image Artifact Viewer

- Displays images with controls
- Supports zooming and navigation
- Provides download and sharing options

### Sheet Artifact Viewer

- Renders tabular data in a grid
- Supports basic data operations
- Allows CSV export

## Integration with Real Backend

When implementing with a real backend:

1. Replace sample content generation with actual AI-generated content
2. Implement proper artifact storage (S3, database, etc.)
3. Add version control for artifacts
4. Implement authentication for artifact access
5. Add collaboration features for shared artifacts

## Future Enhancements

Planned features for the artifact system:

1. **Version History**: Track changes to artifacts over time
2. **Collaborative Editing**: Allow multiple users to work on artifacts
3. **Advanced Artifact Types**: Support for more specialized content types
4. **Export Options**: Additional export formats for artifacts
5. **Integration with External Tools**: Connect to third-party services 